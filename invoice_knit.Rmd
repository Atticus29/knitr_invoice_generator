---
# title: "`r paste0('Invoice - ', format(Sys.Date(), '%B %Y'))`"
# author: "Mark Fisher"
date: "`r Sys.Date()`"
output:
  html_document:
    theme: flatly
    self_contained: true
params:
  csv_path: "sbg_invoice_26_aug_2025.csv"
  invoice_date: "!r Sys.Date()"
  proj_path:
    value: "/Users/markfisher/knitr_invoice_generator/"
  private_rate:
    value: 44.8
  client:
    value: "Straight Blast Gym"
  hourColumn:
    value: "Hours_worked"
  rate:
    value: 21
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo = FALSE, 
  results = 'asis', 
  warning = FALSE, 
  message = FALSE, 
  cache = FALSE, 
  comment = NA
)

# Load required libraries
suppressPackageStartupMessages({
  library(knitr)
  library(lubridate)
  library(data.table)
  library(magrittr)
})

# Set working directories
mainwd <- file.path(params$proj_path)
output_directory <- mainwd
```

```{r css-styles, results='asis'}
cat('<style>
body {
  font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
  line-height: 1.6;
  color: #333;
  max-width: 800px;
  margin: 0 auto;
  padding: 20px;
}
.invoice-header {
  border-bottom: 3px solid #2c3e50;
  margin-bottom: 30px;
  padding-bottom: 20px;
}
.contact-info {
  background-color: #f8f9fa;
  padding: 20px;
  border-left: 4px solid #3498db;
  margin-bottom: 30px;
  border-radius: 5px;
}
.invoice-summary {
  background-color: #fff;
  border: 1px solid #dee2e6;
  border-radius: 8px;
  padding: 20px;
  margin: 30px 0;
}
.summary-table {
  width: 100%;
  border-collapse: collapse;
}
.summary-table th,
.summary-table td {
  padding: 12px;
  text-align: left;
  border-bottom: 1px solid #dee2e6;
}
.summary-table th {
  background-color: #f8f9fa;
  font-weight: 600;
  color: #495057;
}
.amount-due {
  background-color: #e8f5e8;
  font-weight: bold;
  font-size: 1.1em;
}
.hours-table {
  margin: 20px 0;
}
table {
  width: 100%;
  border-collapse: collapse;
  margin: 20px 0;
}
th, td {
  padding: 10px;
  text-align: left;
  border-bottom: 1px solid #dee2e6;
}
th {
  background-color: #f8f9fa;
  font-weight: 600;
  color: #495057;
}
</style>')
```

<div class="invoice-header">
# BBJ Instruction Services Invoice
</div>

<div class="contact-info">
**Mark Fisher**  
Phone: 609.577.9078  
Email: mark.aaron.fisher@gmail.com  
Address: 9421 North Portsmouth Avenue  
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Portland, OR 97203
</div>

```{r data-processing}
# Read and process the hours data
hour_table <- read.csv(params$csv_path, stringsAsFactors = FALSE)

# Filter out private sessions (these are billed separately)
hour_table <- hour_table[!grepl("Private", hour_table$Comments), ]

# Calculate total hours
totalHours <- sum(hour_table[, params$hourColumn])

# Clean column names for display
colnames(hour_table) <- gsub("_", " ", colnames(hour_table))

# Format hours worked to 2 decimal places
hour_table[, "Hours worked"] <- round(hour_table[, "Hours worked"], 2)
```

## Time Tracking Details

```{r hours-table}
kable(
  hour_table, 
  caption = "Detailed Hours Breakdown"
)
```

```{r invoice-summary-data}
# Create invoice summary data frame
invoice_summary <- data.frame(
  Item = c("Client", "Invoice Date", "Service Period", "Services Provided", 
           "Total Hours", "Hourly Rate", "Total Amount Due", "Payment Methods"),
  Details = c(
    params$client,
    format(Sys.Date(), "%B %d, %Y"),
    format(Sys.Date(), "%B %Y"),
    "BJJ Coaching and Instruction Services",
    sprintf("%.2f", totalHours),
    paste0("$", sprintf("%.2f", params$rate)),
    paste0("$", sprintf("%.2f", totalHours * params$rate)),
    "Check or PayPal: mark.aaron.fisher@gmail.com"
  ),
  stringsAsFactors = FALSE
)
```

## Invoice Summary

```{r invoice-summary-table}
kable(
  invoice_summary,
  caption = "Invoice Summary",
  col.names = c("Item", "Details"),
  align = c("l", "l")
)
```


